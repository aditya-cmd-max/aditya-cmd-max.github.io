<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>Reverbit - Profile</title>
    <meta name="description" content="Reverbit Profile - Connect, follow, and grow your network">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700;800;900&family=Lora:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

    <style>
        /* ==================== RESET & VARIABLES ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            /* Light Theme Colors */
            --primary-50: #e8f0fe;
            --primary-100: #d2e3fc;
            --primary-200: #a6c8f9;
            --primary-300: #7aacf5;
            --primary-400: #4e91f2;
            --primary-500: #1a73e8;
            --primary-600: #155cc0;
            --primary-700: #0f4598;
            --primary-800: #0a2e70;
            --primary-900: #051748;
            
            --secondary-50: #e6f4ea;
            --secondary-100: #cee8d6;
            --secondary-200: #9dd1b0;
            --secondary-300: #6dba8a;
            --secondary-400: #3ca364;
            --secondary-500: #0d8a72;
            --secondary-600: #0a6e5b;
            --secondary-700: #075344;
            --secondary-800: #04372d;
            --secondary-900: #021c16;
            
            --premium-50: #fff7e0;
            --premium-100: #ffefc2;
            --premium-200: #ffe085;
            --premium-300: #ffd048;
            --premium-400: #ffc10b;
            --premium-500: #FFD700;
            --premium-600: #e6c200;
            --premium-700: #ccad00;
            --premium-800: #b39700;
            --premium-900: #997a00;
            
            --neutral-50: #f8f9fa;
            --neutral-100: #f1f3f4;
            --neutral-200: #e8eaed;
            --neutral-300: #dadce0;
            --neutral-400: #bdc1c6;
            --neutral-500: #9aa0a6;
            --neutral-600: #80868b;
            --neutral-700: #5f6368;
            --neutral-800: #3c4043;
            --neutral-900: #202124;
            
            --success-50: #e6f4ea;
            --success-500: #34a853;
            --success-700: #0d652d;
            
            --warning-50: #fef7e0;
            --warning-500: #fbbc04;
            --warning-700: #b45f06;
            
            --error-50: #fce8e6;
            --error-500: #ea4335;
            --error-700: #a50e0e;
            
            /* Semantic Colors - Light */
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #f1f3f4;
            
            --text-primary: #202124;
            --text-secondary: #5f6368;
            --text-tertiary: #80868b;
            --text-inverse: #ffffff;
            
            --border-light: #dadce0;
            --border-medium: #bdc1c6;
            
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
            --shadow-2xl: 0 25px 50px -12px rgba(0,0,0,0.25);
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, var(--primary-500), var(--secondary-500));
            --gradient-premium: linear-gradient(135deg, var(--premium-500), var(--premium-700));
            --gradient-verified: linear-gradient(135deg, var(--primary-500), var(--secondary-500));
            
            /* Badge Colors */
            --badge-verified-bg: linear-gradient(135deg, var(--primary-500), var(--secondary-500));
            --badge-premium-bg: linear-gradient(135deg, #FFD700, #FFA500, #FF6347);
            --badge-verified-glow: 0 0 20px rgba(26, 115, 232, 0.3);
            --badge-premium-glow: 0 0 20px rgba(255, 215, 0, 0.3);
            
            /* Spacing */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 40px;
            --space-3xl: 48px;
            --space-4xl: 64px;
            
            /* Typography */
            --font-logo: 'Playfair Display', serif;
            --font-heading: 'Inter', sans-serif;
            --font-body: 'Lora', serif;
            
            /* Border Radius */
            --radius-xs: 4px;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-2xl: 32px;
            --radius-full: 9999px;
            
            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: 500ms cubic-bezier(0.34, 1.56, 0.64, 1);
            
            /* Z-Index */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-toast: 1070;
            --z-tooltip: 1080;
        }

        /* Dark Theme */
        .dark-theme {
            --bg-primary: #202124;
            --bg-secondary: #2d2e30;
            --bg-tertiary: #3c4043;
            
            --text-primary: #e8eaed;
            --text-secondary: #9aa0a6;
            --text-tertiary: #80868b;
            --text-inverse: #202124;
            
            --border-light: #3c4043;
            --border-medium: #5f6368;
            
            --primary-500: #8ab4f8;
            --secondary-500: #81c995;
            
            --badge-verified-glow: 0 0 20px rgba(138, 180, 248, 0.3);
            --badge-premium-glow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        /* ==================== BASE STYLES ==================== */
        html {
            font-size: 16px;
            scroll-behavior: smooth;
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background-color var(--transition-base), color var(--transition-base);
            min-height: 100vh;
        }

        /* ==================== TYPOGRAPHY ==================== */
        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-heading);
            font-weight: 600;
            line-height: 1.3;
            color: var(--text-primary);
        }

        h1 { font-size: 2.5rem; }
        h2 { font-size: 2rem; }
        h3 { font-size: 1.75rem; }
        h4 { font-size: 1.5rem; }
        h5 { font-size: 1.25rem; }
        h6 { font-size: 1rem; }

        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            h2 { font-size: 1.75rem; }
            h3 { font-size: 1.5rem; }
            h4 { font-size: 1.25rem; }
        }

        /* ==================== LAYOUT ==================== */
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 var(--space-md);
        }

        @media (min-width: 768px) {
            .container {
                padding: 0 var(--space-xl);
            }
        }

        /* ==================== BUTTONS ==================== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--radius-full);
            font-family: var(--font-heading);
            font-size: 0.95rem;
            font-weight: 500;
            line-height: 1.5;
            text-decoration: none;
            cursor: pointer;
            transition: all var(--transition-base);
            border: none;
            outline: none;
            min-height: 44px;
            min-width: 44px;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
            pointer-events: none;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:active {
            transform: scale(0.96);
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-500);
            border: 1px solid var(--border-light);
        }

        .btn-outline:hover {
            background: var(--primary-50);
            border-color: var(--primary-500);
        }

        .btn-outline:active {
            background: var(--primary-100);
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
        }

        .btn-ghost:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-icon {
            padding: var(--space-sm);
            border-radius: var(--radius-full);
            aspect-ratio: 1;
        }

        .btn-block {
            width: 100%;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }

        .btn-follow {
            background: var(--primary-500);
            color: white;
            min-width: 100px;
        }

        .btn-following {
            background: var(--success-500);
            color: white;
            min-width: 100px;
        }

        .btn-unfollow {
            background: var(--error-500);
            color: white;
            min-width: 100px;
        }

        /* ==================== BADGES ==================== */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.3px;
            white-space: nowrap;
            transition: all var(--transition-base);
        }

        .badge-verified {
            background: var(--gradient-verified);
            color: white;
            box-shadow: var(--badge-verified-glow);
        }

        .badge-premium {
            background: var(--gradient-premium);
            color: black;
            box-shadow: var(--badge-premium-glow);
        }

        .badge-admin {
            background: var(--primary-500);
            color: white;
        }

        /* ==================== AVATAR ==================== */
        .avatar {
            position: relative;
            display: inline-block;
            border-radius: var(--radius-full);
            overflow: hidden;
            flex-shrink: 0;
        }

        .avatar-sm {
            width: 32px;
            height: 32px;
        }

        .avatar-md {
            width: 48px;
            height: 48px;
        }

        .avatar-lg {
            width: 80px;
            height: 80px;
        }

        .avatar-xl {
            width: 120px;
            height: 120px;
        }

        .avatar-2xl {
            width: 200px;
            height: 200px;
        }

        @media (min-width: 768px) {
            .avatar-2xl {
                width: 240px;
                height: 240px;
            }
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-base);
        }

        .avatar:hover img {
            transform: scale(1.05);
        }

        .avatar-badge {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 28px;
            height: 28px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--bg-primary);
            box-shadow: var(--shadow-md);
            font-size: 0.9rem;
            z-index: 2;
            animation: badgePulse 2s infinite;
        }

        .avatar-badge-verified {
            background: var(--badge-verified-bg);
            color: white;
        }

        .avatar-badge-premium {
            background: var(--badge-premium-bg);
            color: black;
        }

        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .avatar-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity var(--transition-base);
            cursor: pointer;
            color: white;
            font-size: 1.2rem;
        }

        .avatar:hover .avatar-overlay {
            opacity: 1;
        }

        /* ==================== CARDS ==================== */
        .card {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
            overflow: hidden;
            transition: all var(--transition-base);
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--border-light);
        }

        .card-body {
            padding: var(--space-lg);
        }

        .card-footer {
            padding: var(--space-lg);
            border-top: 1px solid var(--border-light);
        }

        /* ==================== FOLLOW STATS ==================== */
        .follow-stats {
            display: flex;
            gap: var(--space-xl);
            margin: var(--space-lg) 0;
            padding: var(--space-md) 0;
            border-top: 1px solid var(--border-light);
            border-bottom: 1px solid var(--border-light);
        }

        .follow-stat {
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            padding: var(--space-xs) var(--space-md);
            border-radius: var(--radius-lg);
        }

        .follow-stat:hover {
            background: var(--bg-tertiary);
        }

        .follow-stat-value {
            font-family: var(--font-heading);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-500);
            line-height: 1.2;
        }

        .follow-stat-label {
            font-size: 0.85rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ==================== USERS GRID ==================== */
        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-md);
            margin-top: var(--space-lg);
        }

        .user-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: all var(--transition-base);
            cursor: pointer;
        }

        .user-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-500);
        }

        .user-card-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-bottom: var(--space-md);
            border: 3px solid var(--primary-500);
            object-fit: cover;
        }

        .user-card-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: var(--space-xs);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            flex-wrap: wrap;
            justify-content: center;
        }

        .user-card-bio {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: var(--space-md);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .user-card-stats {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
            width: 100%;
            justify-content: center;
        }

        .user-card-stat {
            text-align: center;
        }

        .user-card-stat-value {
            font-weight: 700;
            color: var(--primary-500);
        }

        .user-card-stat-label {
            font-size: 0.75rem;
            color: var(--text-tertiary);
        }

        /* ==================== MODAL ==================== */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            padding: var(--space-md);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideUp var(--transition-bounce);
            border: 1px solid var(--border-light);
        }

        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            background: var(--bg-primary);
            z-index: 1;
        }

        .modal-body {
            padding: var(--space-lg);
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: var(--space-lg);
            border-top: 1px solid var(--border-light);
            display: flex;
            gap: var(--space-sm);
            justify-content: flex-end;
            position: sticky;
            bottom: 0;
            background: var(--bg-primary);
        }

        .modal-user-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 1px solid transparent;
        }

        .modal-user-item:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-light);
        }

        .modal-user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }

        .modal-user-info {
            flex: 1;
            min-width: 0;
        }

        .modal-user-name {
            font-weight: 600;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            flex-wrap: wrap;
        }

        .modal-user-email {
            font-size: 0.85rem;
            color: var(--text-tertiary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .modal-user-badge {
            font-size: 0.7rem;
            padding: 2px 8px;
        }

        /* ==================== TOAST ==================== */
        .toast {
            position: fixed;
            bottom: var(--space-lg);
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-full);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            z-index: var(--z-toast);
            opacity: 0;
            transition: all var(--transition-bounce);
            border: 1px solid var(--border-light);
            max-width: 90%;
            min-width: 300px;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast-success {
            background: var(--success-500);
            color: white;
        }

        .toast-error {
            background: var(--error-500);
            color: white;
        }

        .toast-warning {
            background: var(--warning-500);
            color: var(--neutral-900);
        }

        .toast-info {
            background: var(--primary-500);
            color: white;
        }

        /* ==================== LOADING ==================== */
        .loading {
            position: fixed;
            inset: 0;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            transition: opacity var(--transition-base);
        }

        .loading.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--border-light);
            border-top-color: var(--primary-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: var(--space-md);
        }

        .spinner-sm {
            width: 20px;
            height: 20px;
            border-width: 2px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ==================== HEADER ==================== */
        .header {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-light);
            position: sticky;
            top: 0;
            z-index: var(--z-sticky);
            backdrop-filter: blur(8px);
            background: rgba(var(--bg-primary-rgb), 0.8);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            text-decoration: none;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            transition: transform var(--transition-base);
        }

        .logo:hover .logo-icon {
            transform: rotate(15deg) scale(1.1);
        }

        .logo-text {
            font-family: var(--font-logo);
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        /* ==================== SEARCH ==================== */
        .search-section {
            margin: var(--space-lg) 0;
        }

        .search-container {
            position: relative;
        }

        .search-icon {
            position: absolute;
            left: var(--space-md);
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
            pointer-events: none;
        }

        .search-input {
            width: 100%;
            padding: var(--space-md) var(--space-md) var(--space-md) calc(var(--space-md) * 3);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-full);
            font-size: 1rem;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all var(--transition-base);
            outline: none;
            height: 52px;
        }

        .search-input:focus {
            border-color: var(--primary-500);
            box-shadow: 0 0 0 4px var(--primary-50);
        }

        .search-results {
            position: absolute;
            top: calc(100% + var(--space-sm));
            left: 0;
            right: 0;
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: var(--z-dropdown);
        }

        .search-results.show {
            display: block;
            animation: slideDown var(--transition-base);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .search-result-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            cursor: pointer;
            transition: background var(--transition-fast);
            border-bottom: 1px solid var(--border-light);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-item:hover {
            background: var(--bg-tertiary);
        }

        .search-result-avatar {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            object-fit: cover;
        }

        .search-result-info {
            flex: 1;
            min-width: 0;
        }

        .search-result-name {
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            flex-wrap: wrap;
        }

        .search-result-email {
            font-size: 0.85rem;
            color: var(--text-tertiary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .no-results {
            padding: var(--space-xl);
            text-align: center;
            color: var(--text-tertiary);
        }

        /* ==================== PROFILE ==================== */
        .profile-section {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            border: 1px solid var(--border-light);
            overflow: hidden;
            margin-bottom: var(--space-xl);
        }

        .profile-header {
            padding: var(--space-xl);
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-xl);
        }

        @media (min-width: 768px) {
            .profile-header {
                grid-template-columns: 280px 1fr;
            }
        }

        .profile-avatar-wrapper {
            display: flex;
            justify-content: center;
        }

        .profile-avatar {
            position: relative;
            width: 200px;
            height: 200px;
        }

        @media (min-width: 768px) {
            .profile-avatar {
                width: 240px;
                height: 240px;
            }
        }

        .profile-avatar-img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--primary-500);
            box-shadow: var(--shadow-lg);
        }

        .profile-info {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .profile-name-section {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }

        .profile-name {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
        }

        @media (min-width: 768px) {
            .profile-name {
                font-size: 2.5rem;
            }
        }

        .profile-badges {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            flex-wrap: wrap;
        }

        .profile-email {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            color: var(--text-secondary);
            font-size: 1rem;
            background: var(--bg-tertiary);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-full);
            width: fit-content;
        }

        .profile-bio {
            color: var(--text-secondary);
            font-size: 1.1rem;
            line-height: 1.6;
            max-width: 600px;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin: var(--space-md) 0;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-family: var(--font-heading);
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-500);
            line-height: 1.2;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .follow-stats {
            display: flex;
            gap: var(--space-xl);
            margin: var(--space-lg) 0;
            padding: var(--space-md) 0;
            border-top: 1px solid var(--border-light);
            border-bottom: 1px solid var(--border-light);
        }

        .follow-stat {
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            padding: var(--space-xs) var(--space-md);
            border-radius: var(--radius-lg);
        }

        .follow-stat:hover {
            background: var(--bg-tertiary);
        }

        .follow-stat-value {
            font-family: var(--font-heading);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-500);
            line-height: 1.2;
        }

        .follow-stat-label {
            font-size: 0.85rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .profile-actions {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }

        .profile-meta {
            display: flex;
            gap: var(--space-lg);
            color: var(--text-tertiary);
            font-size: 0.9rem;
            flex-wrap: wrap;
        }

        /* ==================== ADMIN PANEL ==================== */
        .admin-section {
            margin-top: var(--space-xl);
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }

        @media (min-width: 768px) {
            .admin-stats {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .stat-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            text-align: center;
        }

        .stat-card-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-500);
            margin-bottom: var(--space-xs);
        }

        .stat-card-label {
            font-size: 0.85rem;
            color: var(--text-tertiary);
        }

        .admin-filters {
            display: flex;
            gap: var(--space-xs);
            margin-bottom: var(--space-lg);
            overflow-x: auto;
            padding-bottom: var(--space-xs);
            -webkit-overflow-scrolling: touch;
        }

        .filter-btn {
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--radius-full);
            border: 1px solid var(--border-light);
            background: var(--bg-primary);
            color: var(--text-secondary);
            font-size: 0.9rem;
            white-space: nowrap;
            cursor: pointer;
            transition: all var(--transition-fast);
            flex-shrink: 0;
        }

        .filter-btn:hover {
            background: var(--bg-tertiary);
        }

        .filter-btn.active {
            background: var(--primary-500);
            color: white;
            border-color: var(--primary-500);
        }

        .users-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .user-row {
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: var(--space-md);
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        @media (min-width: 768px) {
            .user-row {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
            }
        }

        .user-row-info {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            flex: 1;
            min-width: 0;
        }

        .user-row-details {
            flex: 1;
            min-width: 0;
        }

        .user-row-name {
            font-weight: 600;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            flex-wrap: wrap;
        }

        .user-row-email {
            font-size: 0.85rem;
            color: var(--text-tertiary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-row-actions {
            display: flex;
            gap: var(--space-xs);
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .pagination {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-md);
            margin-top: var(--space-xl);
        }

        .pagination-btn {
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-full);
            border: 1px solid var(--border-light);
            background: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all var(--transition-fast);
            min-width: 100px;
        }

        .pagination-btn:hover:not(:disabled) {
            background: var(--primary-500);
            color: white;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ==================== NOT FOUND ==================== */
        .not-found {
            text-align: center;
            padding: var(--space-4xl) var(--space-lg);
        }

        .not-found-icon {
            font-size: 5rem;
            color: var(--text-tertiary);
            margin-bottom: var(--space-xl);
        }

        .not-found-title {
            font-size: 2.5rem;
            margin-bottom: var(--space-md);
        }

        .not-found-text {
            color: var(--text-secondary);
            margin-bottom: var(--space-xl);
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* ==================== UTILITIES ==================== */
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }

        .mt-1 { margin-top: var(--space-xs); }
        .mt-2 { margin-top: var(--space-sm); }
        .mt-3 { margin-top: var(--space-md); }
        .mt-4 { margin-top: var(--space-lg); }
        .mt-5 { margin-top: var(--space-xl); }

        .mb-1 { margin-bottom: var(--space-xs); }
        .mb-2 { margin-bottom: var(--space-sm); }
        .mb-3 { margin-bottom: var(--space-md); }
        .mb-4 { margin-bottom: var(--space-lg); }
        .mb-5 { margin-bottom: var(--space-xl); }

        .ml-1 { margin-left: var(--space-xs); }
        .ml-2 { margin-left: var(--space-sm); }
        .ml-3 { margin-left: var(--space-md); }
        .ml-4 { margin-left: var(--space-lg); }
        .ml-5 { margin-left: var(--space-xl); }

        .mr-1 { margin-right: var(--space-xs); }
        .mr-2 { margin-right: var(--space-sm); }
        .mr-3 { margin-right: var(--space-md); }
        .mr-4 { margin-right: var(--space-lg); }
        .mr-5 { margin-right: var(--space-xl); }

        .p-1 { padding: var(--space-xs); }
        .p-2 { padding: var(--space-sm); }
        .p-3 { padding: var(--space-md); }
        .p-4 { padding: var(--space-lg); }
        .p-5 { padding: var(--space-xl); }

        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: var(--space-xs); }
        .gap-2 { gap: var(--space-sm); }
        .gap-3 { gap: var(--space-md); }
        .gap-4 { gap: var(--space-lg); }
        .gap-5 { gap: var(--space-xl); }

        .w-full { width: 100%; }
        .h-full { height: 100%; }

        .hidden { display: none; }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--neutral-500);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--neutral-600);
        }

        /* Responsive Utilities */
        @media (max-width: 640px) {
            .hide-sm { display: none; }
            
            .btn {
                padding: var(--space-sm) var(--space-md);
            }
            
            .profile-name {
                font-size: 1.8rem;
            }
            
            .profile-stats {
                grid-template-columns: 1fr;
                gap: var(--space-sm);
            }
            
            .stat {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: var(--space-xs) 0;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
            
            .follow-stats {
                gap: var(--space-md);
            }
            
            .users-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (min-width: 641px) and (max-width: 1024px) {
            .profile-header {
                grid-template-columns: 200px 1fr;
            }
            
            .profile-avatar {
                width: 180px;
                height: 180px;
            }
            
            .users-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Form Elements */
        .form-label {
            display: block;
            margin-bottom: var(--space-xs);
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn var(--transition-base);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-in {
            animation: slideIn var(--transition-bounce);
        }

        /* Print Styles */
        @media print {
            .header,
            .search-section,
            .profile-actions,
            .follow-stats,
            .btn {
                display: none;
            }
            
            .profile-section {
                border: none;
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Loading Reverbit...</p>
    </div>

    <!-- Main Container -->
    <div class="container" id="mainContent" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <a href="https://aditya-cmd-max.github.io/reverbit/" class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="logo-text">Reverbit</span>
                </a>
                
                <nav class="nav" id="nav"></nav>
            </div>
        </header>

        <!-- Search Section -->
        <div class="search-section">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" id="searchInput" placeholder="Search users by name, email, or username...">
                
                <div class="search-results" id="searchResults"></div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div id="contentArea"></div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <i class="fas fa-info-circle"></i>
        <span id="toastMessage"></span>
    </div>

    <!-- Followers Modal -->
    <div class="modal" id="followersModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="followersModalTitle">Followers</h3>
                <button class="btn btn-icon btn-ghost" onclick="closeModal('followersModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body" id="followersList">
                <div class="text-center p-4">
                    <div class="spinner spinner-sm"></div>
                    <p class="mt-2">Loading...</p>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('followersModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Following Modal -->
    <div class="modal" id="followingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="followingModalTitle">Following</h3>
                <button class="btn btn-icon btn-ghost" onclick="closeModal('followingModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body" id="followingList">
                <div class="text-center p-4">
                    <div class="spinner spinner-sm"></div>
                    <p class="mt-2">Loading...</p>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('followingModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Verification Modal -->
    <div class="modal" id="verifyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Manage Verification</h3>
                <button class="btn btn-icon btn-ghost" onclick="closeModal('verifyModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div id="modalUserInfo" class="card p-3 mb-4"></div>

                <div class="mb-4">
                    <label class="form-label">Verification Level</label>
                    <select id="verifyLevel" class="search-input">
                        <option value="none">Not Verified</option>
                        <option value="basic">Basic Verified</option>
                        <option value="premium">Premium Verified</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label class="form-label">Notes (Optional)</label>
                    <textarea id="verifyNotes" class="search-input" rows="4" placeholder="Add notes about this verification..."></textarea>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('verifyModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveVerification()">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="color: var(--error-500);">Delete User</h3>
                <button class="btn btn-icon btn-ghost" onclick="closeModal('deleteModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <p class="mb-4">Are you sure you want to delete this user? This action cannot be undone.</p>
                <p class="text-tertiary" id="deleteUserInfo"></p>
            </div>

            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('deleteModal')">Cancel</button>
                <button class="btn btn-primary" style="background: var(--error-500);" onclick="confirmDelete()">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Share Profile</h3>
                <button class="btn btn-icon btn-ghost" onclick="closeModal('shareModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <p class="mb-3">Share this link with others:</p>
                <div class="card p-3 mb-4" id="shareUrl" style="word-break: break-all;"></div>

                <div class="flex gap-2">
                    <button class="btn btn-primary flex-1" onclick="copyShareLink()">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                    <button class="btn btn-outline" onclick="shareViaTwitter()">
                        <i class="fab fa-twitter"></i>
                    </button>
                    <button class="btn btn-outline" onclick="shareViaFacebook()">
                        <i class="fab fa-facebook"></i>
                    </button>
                    <button class="btn btn-outline" onclick="shareViaLinkedIn()">
                        <i class="fab fa-linkedin"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== FIREBASE CONFIG ====================
        const firebaseConfig = {
            apiKey: "AIzaSyDE0eix0uVHuUS5P5DbuPA-SZt6pD8ob8A",
            authDomain: "reverbit11.firebaseapp.com",
            projectId: "reverbit11",
            storageBucket: "reverbit11.firebasestorage.app",
            messagingSenderId: "607495314412",
            appId: "1:607495314412:web:8c098f88b0d3b4620f7ec9",
            measurementId: "G-DMWMRM1M47"
        };

        const ADMIN_EMAIL = 'adityajha1104@gmail.com';
        const USERS_PER_PAGE = 20;

        // ==================== INITIALIZE FIREBASE ====================
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Enable persistence
        db.enablePersistence({ synchronizeTabs: true }).catch(err => {
            console.warn('Firestore persistence error:', err);
        });

        // ==================== GLOBAL STATE ====================
        const state = {
            currentUser: null,
            currentUserProfile: null,
            profileData: null,
            profileOwner: null,
            isOwner: false,
            isFollowing: false,
            followers: [],
            following: [],
            followersCount: 0,
            followingCount: 0,
            allUsers: [],
            filteredUsers: [],
            currentPage: 1,
            selectedUserId: null,
            searchTimeout: null,
            currentFilter: 'all',
            theme: localStorage.getItem('theme') || 'light',
            isLoading: false
        };

        // ==================== DOM ELEMENTS ====================
        const elements = {
            loading: document.getElementById('loading'),
            mainContent: document.getElementById('mainContent'),
            contentArea: document.getElementById('contentArea'),
            nav: document.getElementById('nav'),
            searchInput: document.getElementById('searchInput'),
            searchResults: document.getElementById('searchResults'),
            toast: document.getElementById('toast'),
            toastMessage: document.getElementById('toastMessage'),
            followersModal: document.getElementById('followersModal'),
            followingModal: document.getElementById('followingModal'),
            followersList: document.getElementById('followersList'),
            followingList: document.getElementById('followingList'),
            followersModalTitle: document.getElementById('followersModalTitle'),
            followingModalTitle: document.getElementById('followingModalTitle'),
            verifyModal: document.getElementById('verifyModal'),
            deleteModal: document.getElementById('deleteModal'),
            shareModal: document.getElementById('shareModal'),
            modalUserInfo: document.getElementById('modalUserInfo'),
            verifyLevel: document.getElementById('verifyLevel'),
            verifyNotes: document.getElementById('verifyNotes'),
            deleteUserInfo: document.getElementById('deleteUserInfo'),
            shareUrl: document.getElementById('shareUrl')
        };

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', async () => {
            console.log(' Reverbit Profile with Follow System initializing...');
            
            applyTheme(state.theme);
            
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('id');
            
            // Setup auth listener
            auth.onAuthStateChanged(async (user) => {
                console.log(' Auth state changed:', user ? 'Logged in' : 'Logged out');
                
                state.currentUser = user;
                
                if (user) {
                    await loadUserProfile(user.uid);
                    await loadFollowData(user.uid);
                } else {
                    state.currentUserProfile = null;
                    state.followers = [];
                    state.following = [];
                }
                
                updateNavigation();
                
                if (userId) {
                    await loadProfile(userId);
                } else if (user) {
                    window.location.href = `?id=${user.uid}`;
                } else {
                    showLanding();
                }
                
                if (user) {
                    await loadAllUsers();
                }
            });

            // Search input handler
            elements.searchInput.addEventListener('input', (e) => {
                clearTimeout(state.searchTimeout);
                state.searchTimeout = setTimeout(() => {
                    searchUsers(e.target.value);
                }, 300);
            });

            // Close search results on outside click
            document.addEventListener('click', (e) => {
                if (!elements.searchResults.contains(e.target) && !elements.searchInput.contains(e.target)) {
                    elements.searchResults.classList.remove('show');
                }
            });

            console.log(' Reverbit Profile initialized');
        });

        // ==================== THEME MANAGEMENT ====================
        function applyTheme(theme) {
            document.body.className = theme === 'dark' ? 'dark-theme' : '';
            localStorage.setItem('theme', theme);
            state.theme = theme;
        }

        function toggleTheme() {
            const newTheme = state.theme === 'light' ? 'dark' : 'light';
            applyTheme(newTheme);
            updateNavigation();
            showToast(`Theme switched to ${newTheme} mode`, 'info');
        }

        // ==================== NAVIGATION ====================
        function updateNavigation() {
            const isAdmin = state.currentUser?.email === ADMIN_EMAIL;
            
            let navHtml = `
                <button class="btn btn-icon btn-ghost" onclick="toggleTheme()" title="Toggle theme">
                    <i class="fas fa-${state.theme === 'dark' ? 'sun' : 'moon'}"></i>
                </button>
            `;
            
            if (state.currentUser) {
                navHtml += `
                    <a href="https://aditya-cmd-max.github.io/dashboard" class="btn btn-outline hide-sm">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a href="?id=${state.currentUser.uid}" class="btn btn-primary">
                        <i class="fas fa-user"></i> Profile
                    </a>
                    ${isAdmin ? `
                        <button class="btn btn-outline hide-sm" onclick="showAdminPanel()">
                            <i class="fas fa-shield-alt"></i> Admin
                        </button>
                    ` : ''}
                    <button class="btn btn-outline" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                `;
            } else {
                navHtml += `
                    <a href="https://aditya-cmd-max.github.io/signin" class="btn btn-outline">Sign In</a>
                    <a href="https://aditya-cmd-max.github.io/signup" class="btn btn-primary">Sign Up</a>
                `;
            }
            
            elements.nav.innerHTML = navHtml;
        }

        // ==================== LOAD USER PROFILE ====================
        async function loadUserProfile(uid) {
            try {
                const doc = await db.collection('users').doc(uid).get();
                
                if (doc.exists) {
                    state.currentUserProfile = { uid: doc.id, ...doc.data() };
                } else {
                    state.currentUserProfile = await createUserProfile(uid);
                }
                
                console.log(' User profile loaded:', state.currentUserProfile);
                
            } catch (error) {
                console.error('Error loading user profile:', error);
            }
        }

        async function createUserProfile(uid) {
            const displayName = state.currentUser.displayName || 
                               state.currentUser.email.split('@')[0] || 
                               'User';
            
            const profile = {
                uid: uid,
                email: state.currentUser.email,
                displayName: displayName,
                username: generateUsername(displayName),
                photoURL: `https://ui-avatars.com/api/?name=${encodeURIComponent(displayName)}&background=1a73e8&color=fff&bold=true&size=400`,
                bio: '',
                isPublic: true,
                verified: false,
                verifiedLevel: 'none',
                premiumVerified: false,
                followersCount: 0,
                followingCount: 0,
                streak: 0,
                totalLogins: 1,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                lastActive: new Date().toISOString(),
                lastLogin: new Date().toISOString(),
                theme: 'auto'
            };
            
            await db.collection('users').doc(uid).set(profile);
            return profile;
        }

        function generateUsername(displayName) {
            return displayName.toLowerCase()
                .replace(/[^a-z0-9]/g, '')
                .substring(0, 15) + 
                Math.random().toString(36).substring(2, 6);
        }

        // ==================== FOLLOW SYSTEM ====================
        async function loadFollowData(uid) {
            try {
                // Load followers
                const followersSnapshot = await db.collection('followers')
                    .where('followingId', '==', uid)
                    .get();
                
                state.followers = followersSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Load following
                const followingSnapshot = await db.collection('followers')
                    .where('followerId', '==', uid)
                    .get();
                
                state.following = followingSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Update counts
                state.followersCount = state.followers.length;
                state.followingCount = state.following.length;
                
                // Update user document with counts
                await db.collection('users').doc(uid).update({
                    followersCount: state.followersCount,
                    followingCount: state.followingCount
                });
                
                console.log(' Follow data loaded:', {
                    followers: state.followersCount,
                    following: state.followingCount
                });
                
            } catch (error) {
                console.error('Error loading follow data:', error);
            }
        }

        async function checkFollowStatus(followerId, followingId) {
            if (!followerId || !followingId) return false;
            
            try {
                const query = await db.collection('followers')
                    .where('followerId', '==', followerId)
                    .where('followingId', '==', followingId)
                    .get();
                
                return !query.empty;
            } catch (error) {
                console.error('Error checking follow status:', error);
                return false;
            }
        }

        async function toggleFollow() {
            if (!state.currentUser) {
                showToast('Please sign in to follow users', 'info');
                return;
            }
            
            if (state.isOwner) {
                showToast('You cannot follow yourself', 'warning');
                return;
            }
            
            const followerId = state.currentUser.uid;
            const followingId = state.profileOwner;
            
            try {
                if (state.isFollowing) {
                    // Unfollow
                    const query = await db.collection('followers')
                        .where('followerId', '==', followerId)
                        .where('followingId', '==', followingId)
                        .get();
                    
                    if (!query.empty) {
                        await query.docs[0].ref.delete();
                        
                        // Update counts
                        state.followersCount = Math.max(0, state.followersCount - 1);
                        state.followingCount = state.followingCount;
                        
                        await db.collection('users').doc(followingId).update({
                            followersCount: state.followersCount
                        });
                        
                        await db.collection('users').doc(followerId).update({
                            followingCount: firebase.firestore.FieldValue.increment(-1)
                        });
                        
                        state.isFollowing = false;
                        
                        // Update button
                        const followBtn = document.getElementById('followBtn');
                        if (followBtn) {
                            followBtn.className = 'btn btn-primary';
                            followBtn.innerHTML = '<i class="fas fa-user-plus"></i> Follow';
                        }
                        
                        showToast(`Unfollowed ${state.profileData.displayName || 'user'}`);
                    }
                } else {
                    // Follow
                    await db.collection('followers').add({
                        followerId: followerId,
                        followingId: followingId,
                        followerName: state.currentUserProfile?.displayName || state.currentUser.email,
                        followingName: state.profileData.displayName || 'User',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Update counts
                    state.followersCount += 1;
                    state.followingCount = state.followingCount;
                    
                    await db.collection('users').doc(followingId).update({
                        followersCount: firebase.firestore.FieldValue.increment(1)
                    });
                    
                    await db.collection('users').doc(followerId).update({
                        followingCount: firebase.firestore.FieldValue.increment(1)
                    });
                    
                    state.isFollowing = true;
                    
                    // Update button
                    const followBtn = document.getElementById('followBtn');
                    if (followBtn) {
                        followBtn.className = 'btn btn-following';
                        followBtn.innerHTML = '<i class="fas fa-user-check"></i> Following';
                    }
                    
                    showToast(`You are now following ${state.profileData.displayName || 'user'}`);
                }
                
                // Refresh follow data
                await loadFollowData(followerId);
                
            } catch (error) {
                console.error('Error toggling follow:', error);
                showToast('Error updating follow status', 'error');
            }
        }

        async function showFollowers() {
            if (!state.profileData) return;
            
            elements.followersModalTitle.textContent = `People following ${state.profileData.displayName || 'this user'}`;
            elements.followersList.innerHTML = '<div class="text-center p-4"><div class="spinner spinner-sm"></div><p class="mt-2">Loading...</p></div>';
            elements.followersModal.classList.add('active');
            
            try {
                const followersSnapshot = await db.collection('followers')
                    .where('followingId', '==', state.profileOwner)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                if (followersSnapshot.empty) {
                    elements.followersList.innerHTML = `
                        <div class="text-center p-4">
                            <i class="fas fa-users" style="font-size: 3rem; color: var(--text-tertiary); margin-bottom: var(--space-md);"></i>
                            <p>No followers yet</p>
                        </div>
                    `;
                    return;
                }
                
                // Get follower details
                const followerIds = followersSnapshot.docs.map(doc => doc.data().followerId);
                const followerProfiles = await Promise.all(
                    followerIds.map(async (id) => {
                        const doc = await db.collection('users').doc(id).get();
                        return { uid: id, ...doc.data() };
                    })
                );
                
                elements.followersList.innerHTML = followerProfiles.map(user => `
                    <div class="modal-user-item" onclick="viewUserProfile('${user.uid}')">
                        <img src="${getAvatarUrl(user)}" alt="${user.displayName || 'User'}" class="modal-user-avatar">
                        <div class="modal-user-info">
                            <div class="modal-user-name">
                                ${user.displayName || 'User'}
                                ${getBadges(user)}
                            </div>
                            <div class="modal-user-email">${user.email || ''}</div>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error loading followers:', error);
                elements.followersList.innerHTML = `
                    <div class="text-center p-4 text-error">
                        <i class="fas fa-exclamation-circle" style="font-size: 3rem; margin-bottom: var(--space-md);"></i>
                        <p>Error loading followers</p>
                    </div>
                `;
            }
        }

        async function showFollowing() {
            if (!state.profileData) return;
            
            elements.followingModalTitle.textContent = `People ${state.profileData.displayName || 'this user'} follows`;
            elements.followingList.innerHTML = '<div class="text-center p-4"><div class="spinner spinner-sm"></div><p class="mt-2">Loading...</p></div>';
            elements.followingModal.classList.add('active');
            
            try {
                const followingSnapshot = await db.collection('followers')
                    .where('followerId', '==', state.profileOwner)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                if (followingSnapshot.empty) {
                    elements.followingList.innerHTML = `
                        <div class="text-center p-4">
                            <i class="fas fa-user-friends" style="font-size: 3rem; color: var(--text-tertiary); margin-bottom: var(--space-md);"></i>
                            <p>Not following anyone yet</p>
                        </div>
                    `;
                    return;
                }
                
                // Get following details
                const followingIds = followingSnapshot.docs.map(doc => doc.data().followingId);
                const followingProfiles = await Promise.all(
                    followingIds.map(async (id) => {
                        const doc = await db.collection('users').doc(id).get();
                        return { uid: id, ...doc.data() };
                    })
                );
                
                elements.followingList.innerHTML = followingProfiles.map(user => `
                    <div class="modal-user-item" onclick="viewUserProfile('${user.uid}')">
                        <img src="${getAvatarUrl(user)}" alt="${user.displayName || 'User'}" class="modal-user-avatar">
                        <div class="modal-user-info">
                            <div class="modal-user-name">
                                ${user.displayName || 'User'}
                                ${getBadges(user)}
                            </div>
                            <div class="modal-user-email">${user.email || ''}</div>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error loading following:', error);
                elements.followingList.innerHTML = `
                    <div class="text-center p-4 text-error">
                        <i class="fas fa-exclamation-circle" style="font-size: 3rem; margin-bottom: var(--space-md);"></i>
                        <p>Error loading following</p>
                    </div>
                `;
            }
        }

        // ==================== LOAD PROFILE ====================
        async function loadProfile(userId) {
            showLoading(true);
            hideAllSections();

            try {
                const doc = await db.collection('users').doc(userId).get();
                
                if (!doc.exists) {
                    showNotFound('Profile not found');
                    return;
                }

                state.profileData = { uid: doc.id, ...doc.data() };
                state.profileOwner = userId;
                state.isOwner = state.currentUser && state.currentUser.uid === userId;

                // Check privacy
                if (!state.profileData.isPublic && !state.isOwner) {
                    showNotFound('This profile is private');
                    return;
                }

                // Check follow status
                if (state.currentUser && !state.isOwner) {
                    state.isFollowing = await checkFollowStatus(state.currentUser.uid, userId);
                }

                // Load follow counts
                state.followersCount = state.profileData.followersCount || 0;
                state.followingCount = state.profileData.followingCount || 0;

                renderProfile(state.profileData);
                
                // Update last active if owner
                if (state.isOwner) {
                    updateLastActive();
                }

            } catch (error) {
                console.error('Error loading profile:', error);
                showToast('Error loading profile', 'error');
                showNotFound();
            } finally {
                showLoading(false);
            }
        }

        // ==================== RENDER PROFILE ====================
        function renderProfile(data) {
            const memberDays = calculateMemberDays(data.createdAt);
            const lastActive = formatLastActive(data.lastActive);
            const verificationLevel = getVerificationLevel(data);

            const followButton = !state.isOwner && state.currentUser ? `
                <button class="btn ${state.isFollowing ? 'btn-following' : 'btn-primary'}" id="followBtn" onclick="toggleFollow()">
                    <i class="fas fa-user-${state.isFollowing ? 'check' : 'plus'}"></i>
                    ${state.isFollowing ? 'Following' : 'Follow'}
                </button>
            ` : '';

            const content = `
                <div class="profile-section">
                    <div class="profile-header">
                        <div class="profile-avatar-wrapper">
                            <div class="profile-avatar">
                                <img src="${getAvatarUrl(data)}" alt="${data.displayName}" class="profile-avatar-img" 
                                     onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(data.displayName || 'User')}&background=1a73e8&color=fff&bold=true'">
                                ${getAvatarBadge(data)}
                                ${state.isOwner ? `
                                    <div class="avatar-overlay" onclick="handleAvatarUpload()">
                                        <i class="fas fa-camera"></i>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div class="profile-info">
                            <div>
                                <div class="profile-name-section">
                                    <h1 class="profile-name">${data.displayName || 'User'}</h1>
                                    <div class="profile-badges">
                                        ${getBadges(data)}
                                        ${data.email === ADMIN_EMAIL ? `
                                            <span class="badge badge-admin">
                                                <i class="fas fa-shield-alt"></i> Admin
                                            </span>
                                        ` : ''}
                                    </div>
                                </div>
                                
                                <div class="profile-email">
                                    <i class="fas fa-envelope"></i>
                                    ${data.email || 'No email'}
                                </div>
                            </div>
                            
                            <p class="profile-bio">${data.bio || 'No bio added yet.'}</p>
                            
                            <div class="profile-stats">
                                <div class="stat">
                                    <div class="stat-value">${data.streak || 0}</div>
                                    <div class="stat-label">Day Streak</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-value">${memberDays}</div>
                                    <div class="stat-label">Member Days</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-value">${data.totalLogins || 1}</div>
                                    <div class="stat-label">Total Logins</div>
                                </div>
                            </div>
                            
                            <div class="follow-stats">
                                <div class="follow-stat" onclick="showFollowers()">
                                    <div class="follow-stat-value">${state.followersCount}</div>
                                    <div class="follow-stat-label">Followers</div>
                                </div>
                                <div class="follow-stat" onclick="showFollowing()">
                                    <div class="follow-stat-value">${state.followingCount}</div>
                                    <div class="follow-stat-label">Following</div>
                                </div>
                            </div>
                            
                            <div class="profile-actions">
                                ${state.isOwner ? `
                                    <a href="https://aditya-cmd-max.github.io/dashboard#profile" class="btn btn-primary">
                                        <i class="fas fa-edit"></i> Edit Profile
                                    </a>
                                    <button class="btn btn-outline" onclick="togglePrivacy()">
                                        <i class="fas fa-${data.isPublic ? 'eye' : 'eye-slash'}"></i>
                                        ${data.isPublic ? 'Make Private' : 'Make Public'}
                                    </button>
                                ` : followButton}
                                
                                <button class="btn btn-outline" onclick="shareProfile()">
                                    <i class="fas fa-share-alt"></i> Share
                                </button>
                                
                                ${state.currentUser?.email === ADMIN_EMAIL && !state.isOwner ? `
                                    <button class="btn btn-outline" onclick="openVerifyModal('${data.uid}', '${data.displayName || 'User'}', '${verificationLevel}')">
                                        <i class="fas fa-shield-alt"></i> Manage
                                    </button>
                                ` : ''}
                            </div>
                            
                            <div class="profile-meta">
                                <span><i class="fas fa-clock"></i> Last active: ${lastActive}</span>
                                <span><i class="fas fa-calendar"></i> Joined: ${formatDate(data.createdAt)}</span>
                                ${verificationLevel !== 'none' ? `
                                    <span><i class="fas fa-check-circle"></i> Verified: ${formatDate(data.verifiedAt)}</span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            elements.contentArea.innerHTML = content;
        }

        function getVerificationLevel(data) {
            if (data.verifiedLevel === 'premium') return 'premium';
            if (data.verifiedLevel === 'basic' || data.verified) return 'basic';
            return 'none';
        }

        function getBadges(data) {
            const level = getVerificationLevel(data);
            
            if (level === 'premium') {
                return `<span class="badge badge-premium"><i class="fas fa-crown"></i> Premium Verified</span>`;
            } else if (level === 'basic') {
                return `<span class="badge badge-verified"><i class="fas fa-check-circle"></i> Verified</span>`;
            }
            return '';
        }

        function getAvatarBadge(data) {
            const level = getVerificationLevel(data);
            
            if (level === 'premium') {
                return `<div class="avatar-badge avatar-badge-premium"><i class="fas fa-crown"></i></div>`;
            } else if (level === 'basic') {
                return `<div class="avatar-badge avatar-badge-verified"><i class="fas fa-check"></i></div>`;
            }
            return '';
        }

        // ==================== LOAD ALL USERS ====================
        async function loadAllUsers() {
            try {
                const snapshot = await db.collection('users').get();
                state.allUsers = snapshot.docs.map(doc => ({
                    uid: doc.id,
                    ...doc.data()
                }));
                
                // Sort by followers count
                state.allUsers.sort((a, b) => (b.followersCount || 0) - (a.followersCount || 0));
                
                console.log(` Loaded ${state.allUsers.length} users`);
                
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        // ==================== SEARCH USERS ====================
        function searchUsers(query) {
            query = query.trim().toLowerCase();
            
            if (!query) {
                elements.searchResults.classList.remove('show');
                return;
            }
            
            const results = state.allUsers
                .filter(user => 
                    (user.displayName && user.displayName.toLowerCase().includes(query)) ||
                    (user.email && user.email.toLowerCase().includes(query)) ||
                    (user.username && user.username.toLowerCase().includes(query))
                )
                .slice(0, 10);
            
            if (results.length === 0) {
                elements.searchResults.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search" style="font-size: 2rem; margin-bottom: var(--space-md);"></i>
                        <p>No users found matching "${query}"</p>
                    </div>
                `;
            } else {
                elements.searchResults.innerHTML = results.map(user => `
                    <div class="search-result-item" onclick="viewUserProfile('${user.uid}')">
                        <img src="${getAvatarUrl(user)}" alt="${user.displayName || 'User'}" class="search-result-avatar"
                             onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || 'User')}&background=1a73e8&color=fff&bold=true'">
                        <div class="search-result-info">
                            <div class="search-result-name">
                                ${user.displayName || 'User'}
                                ${getBadges(user)}
                            </div>
                            <div class="search-result-email">${user.email || ''}</div>
                            <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-top: 2px;">
                                <i class="fas fa-users"></i> ${user.followersCount || 0} followers
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            elements.searchResults.classList.add('show');
        }

        // ==================== ADMIN PANEL ====================
        async function showAdminPanel() {
            if (state.currentUser?.email !== ADMIN_EMAIL) {
                showToast('Admin access required', 'error');
                return;
            }

            showLoading(true);
            hideAllSections();
            
            await loadAllUsers();
            
            const stats = calculateAdminStats();
            
            const content = `
                <div class="admin-section">
                    <h2 class="mb-4">Admin Verification Panel</h2>
                    
                    <div class="admin-stats">
                        <div class="stat-card">
                            <div class="stat-card-value">${stats.total}</div>
                            <div class="stat-card-label">Total Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-value">${stats.verified}</div>
                            <div class="stat-card-label">Verified</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-value">${stats.premium}</div>
                            <div class="stat-card-label">Premium</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-value">${stats.activeToday}</div>
                            <div class="stat-card-label">Active Today</div>
                        </div>
                    </div>
                    
                    <div class="admin-filters" id="adminFilters">
                        <button class="filter-btn active" onclick="filterUsers('all')">All Users</button>
                        <button class="filter-btn" onclick="filterUsers('verified')">Verified</button>
                        <button class="filter-btn" onclick="filterUsers('premium')">Premium</button>
                        <button class="filter-btn" onclick="filterUsers('unverified')">Unverified</button>
                    </div>
                    
                    <div class="users-list" id="usersList"></div>
                    
                    <div class="pagination" id="pagination">
                        <button class="pagination-btn" id="prevPage" onclick="changePage('prev')" disabled>
                            <i class="fas fa-chevron-left"></i> Previous
                        </button>
                        <span id="pageInfo">Page 1</span>
                        <button class="pagination-btn" id="nextPage" onclick="changePage('next')">
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            `;
            
            elements.contentArea.innerHTML = content;
            
            filterUsers('all');
            showLoading(false);
        }

        function calculateAdminStats() {
            const today = new Date().toDateString();
            
            return {
                total: state.allUsers.length,
                verified: state.allUsers.filter(u => u.verified === true || u.verifiedLevel === 'basic').length,
                premium: state.allUsers.filter(u => u.verifiedLevel === 'premium').length,
                activeToday: state.allUsers.filter(u => {
                    if (!u.lastActive) return false;
                    return new Date(u.lastActive).toDateString() === today;
                }).length
            };
        }

        function filterUsers(filter) {
            state.currentFilter = filter;
            
            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.toLowerCase().includes(filter));
            });
            
            // Apply filter
            switch (filter) {
                case 'verified':
                    state.filteredUsers = state.allUsers.filter(u => u.verified === true || u.verifiedLevel === 'basic');
                    break;
                case 'premium':
                    state.filteredUsers = state.allUsers.filter(u => u.verifiedLevel === 'premium');
                    break;
                case 'unverified':
                    state.filteredUsers = state.allUsers.filter(u => !u.verified && !u.verifiedLevel);
                    break;
                default:
                    state.filteredUsers = [...state.allUsers];
            }
            
            state.currentPage = 1;
            renderUsers();
        }

        function renderUsers() {
            const start = (state.currentPage - 1) * USERS_PER_PAGE;
            const end = start + USERS_PER_PAGE;
            const paginatedUsers = state.filteredUsers.slice(start, end);
            const totalPages = Math.ceil(state.filteredUsers.length / USERS_PER_PAGE);
            
            // Update pagination
            document.getElementById('pageInfo').textContent = `Page ${state.currentPage} of ${totalPages || 1}`;
            document.getElementById('prevPage').disabled = state.currentPage === 1;
            document.getElementById('nextPage').disabled = state.currentPage === totalPages || totalPages === 0;
            
            if (paginatedUsers.length === 0) {
                document.getElementById('usersList').innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-users-slash" style="font-size: 3rem; margin-bottom: var(--space-lg);"></i>
                        <p>No users found</p>
                    </div>
                `;
                return;
            }
            
            document.getElementById('usersList').innerHTML = paginatedUsers.map(user => {
                const level = getVerificationLevel(user);
                
                return `
                    <div class="user-row">
                        <div class="user-row-info">
                            <div class="avatar avatar-md">
                                <img src="${getAvatarUrl(user)}" alt="${user.displayName || 'User'}"
                                     onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || 'User')}&background=1a73e8&color=fff&bold=true'">
                            </div>
                            <div class="user-row-details">
                                <div class="user-row-name">
                                    ${user.displayName || 'User'}
                                    ${getBadges(user)}
                                </div>
                                <div class="user-row-email">${user.email || ''}</div>
                                <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-top: 2px;">
                                    <i class="fas fa-users"></i> ${user.followersCount || 0} followers
                                </div>
                            </div>
                        </div>
                        
                        <div class="user-row-actions">
                            <button class="btn btn-icon btn-ghost" onclick="viewUserProfile('${user.uid}')" title="View Profile">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-icon btn-ghost" onclick="openVerifyModal('${user.uid}', '${user.displayName || 'User'}', '${level}')" title="Manage Verification">
                                <i class="fas fa-${level === 'premium' ? 'crown' : 'shield-alt'}"></i>
                            </button>
                            ${user.email !== ADMIN_EMAIL ? `
                                <button class="btn btn-icon btn-ghost" style="color: var(--error-500);" onclick="openDeleteModal('${user.uid}', '${user.displayName || 'User'}')" title="Delete User">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function changePage(direction) {
            if (direction === 'prev' && state.currentPage > 1) {
                state.currentPage--;
            } else if (direction === 'next' && state.currentPage < Math.ceil(state.filteredUsers.length / USERS_PER_PAGE)) {
                state.currentPage++;
            }
            renderUsers();
        }

        // ==================== VERIFICATION FUNCTIONS ====================
        function openVerifyModal(userId, userName, currentLevel) {
            state.selectedUserId = userId;
            
            elements.modalUserInfo.innerHTML = `
                <div class="flex items-center gap-3">
                    <div class="avatar avatar-md">
                        <div style="width: 100%; height: 100%; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                            ${userName.charAt(0).toUpperCase()}
                        </div>
                    </div>
                    <div>
                        <h4>${userName}</h4>
                        <p style="color: var(--text-tertiary); font-size: 0.85rem;">ID: ${userId}</p>
                    </div>
                </div>
            `;
            
            elements.verifyLevel.value = currentLevel;
            elements.verifyNotes.value = '';
            
            elements.verifyModal.classList.add('active');
        }

        async function saveVerification() {
            if (!state.selectedUserId) return;
            
            const level = elements.verifyLevel.value;
            const notes = elements.verifyNotes.value;
            
            try {
                const updateData = {
                    verifiedLevel: level === 'none' ? null : level,
                    verified: level !== 'none',
                    verifiedAt: level !== 'none' ? firebase.firestore.FieldValue.serverTimestamp() : null,
                    verifiedBy: level !== 'none' ? ADMIN_EMAIL : null,
                    verificationNotes: notes || null,
                    premiumVerified: level === 'premium',
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('users').doc(state.selectedUserId).update(updateData);
                
                showToast(`User ${level === 'premium' ? 'Premium Verified' : level === 'basic' ? 'Verified' : 'Unverified'} successfully!`);
                
                // Refresh data
                if (elements.contentArea.querySelector('.admin-section')) {
                    await loadAllUsers();
                    const stats = calculateAdminStats();
                    
                    // Update stats
                    document.querySelectorAll('.stat-card-value')[0].textContent = stats.total;
                    document.querySelectorAll('.stat-card-value')[1].textContent = stats.verified;
                    document.querySelectorAll('.stat-card-value')[2].textContent = stats.premium;
                    document.querySelectorAll('.stat-card-value')[3].textContent = stats.activeToday;
                    
                    filterUsers(state.currentFilter);
                }
                
                // Refresh profile if viewing this user
                if (state.profileData && state.profileData.uid === state.selectedUserId) {
                    const doc = await db.collection('users').doc(state.selectedUserId).get();
                    state.profileData = { uid: doc.id, ...doc.data() };
                    renderProfile(state.profileData);
                }
                
                closeModal('verifyModal');
                
            } catch (error) {
                console.error('Error updating verification:', error);
                showToast('Error updating verification', 'error');
            }
        }

        // ==================== DELETE FUNCTIONS ====================
        function openDeleteModal(userId, userName) {
            state.selectedUserId = userId;
            elements.deleteUserInfo.textContent = `User: ${userName}`;
            elements.deleteModal.classList.add('active');
        }

        async function confirmDelete() {
            try {
                await db.collection('users').doc(state.selectedUserId).delete();
                showToast('User deleted successfully');
                
                if (elements.contentArea.querySelector('.admin-section')) {
                    await loadAllUsers();
                    const stats = calculateAdminStats();
                    
                    document.querySelectorAll('.stat-card-value')[0].textContent = stats.total;
                    document.querySelectorAll('.stat-card-value')[1].textContent = stats.verified;
                    document.querySelectorAll('.stat-card-value')[2].textContent = stats.premium;
                    document.querySelectorAll('.stat-card-value')[3].textContent = stats.activeToday;
                    
                    filterUsers(state.currentFilter);
                }
                
                closeModal('deleteModal');
                
            } catch (error) {
                console.error('Error deleting user:', error);
                showToast('Error deleting user', 'error');
            }
        }

        // ==================== PROFILE ACTIONS ====================
        async function togglePrivacy() {
            if (!state.isOwner || !state.profileData) return;
            
            try {
                const newStatus = !state.profileData.isPublic;
                
                await db.collection('users').doc(state.profileData.uid).update({
                    isPublic: newStatus,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                state.profileData.isPublic = newStatus;
                renderProfile(state.profileData);
                
                showToast(`Profile is now ${newStatus ? 'public' : 'private'}`);
                
            } catch (error) {
                console.error('Error toggling privacy:', error);
                showToast('Error updating privacy', 'error');
            }
        }

        function shareProfile() {
            const url = window.location.href;
            elements.shareUrl.textContent = url;
            elements.shareModal.classList.add('active');
        }

        function copyShareLink() {
            navigator.clipboard.writeText(elements.shareUrl.textContent);
            showToast('Link copied to clipboard!');
            closeModal('shareModal');
        }

        function shareViaTwitter() {
            const url = elements.shareUrl.textContent;
            window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}`, '_blank');
        }

        function shareViaFacebook() {
            const url = elements.shareUrl.textContent;
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
        }

        function shareViaLinkedIn() {
            const url = elements.shareUrl.textContent;
            window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`, '_blank');
        }

        // ==================== AVATAR UPLOAD ====================
        function handleAvatarUpload() {
            // Create file input
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    await uploadAvatar(file);
                }
            };
            input.click();
        }

        async function uploadAvatar(file) {
            if (!state.currentUser) return;
            
            // Validate file
            if (file.size > 5 * 1024 * 1024) {
                showToast('Image must be less than 5MB', 'error');
                return;
            }
            
            if (!file.type.startsWith('image/')) {
                showToast('Please select an image file', 'error');
                return;
            }
            
            showToast('Uploading...', 'info');
            
            try {
                // Convert to base64 for demo (in production, use Cloudinary)
                const reader = new FileReader();
                reader.onloadend = async () => {
                    const base64 = reader.result;
                    
                    // Update Firestore with base64 (demo only - use Cloudinary in production)
                    await db.collection('users').doc(state.currentUser.uid).update({
                        photoURL: base64,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Update local data
                    state.currentUserProfile.photoURL = base64;
                    if (state.profileData && state.profileData.uid === state.currentUser.uid) {
                        state.profileData.photoURL = base64;
                        renderProfile(state.profileData);
                    }
                    
                    showToast('Profile picture updated!', 'success');
                };
                reader.readAsDataURL(file);
                
            } catch (error) {
                console.error('Error uploading avatar:', error);
                showToast('Error uploading image', 'error');
            }
        }

        // ==================== UTILITY FUNCTIONS ====================
        function showLoading(show) {
            state.isLoading = show;
            elements.loading.classList.toggle('hidden', !show);
            if (!show) elements.mainContent.style.display = 'block';
        }

        function hideAllSections() {
            elements.contentArea.innerHTML = '';
        }

        function showLanding() {
            elements.contentArea.innerHTML = `
                <div class="card text-center p-5">
                    <i class="fas fa-users" style="font-size: 4rem; color: var(--primary-500); margin-bottom: var(--space-lg);"></i>
                    <h2 class="mb-3">Welcome to Reverbit</h2>
                    <p class="text-secondary mb-4">Sign in to view your profile, connect with others, and grow your network.</p>
                    <div class="flex gap-3 justify-center">
                        <a href="https://aditya-cmd-max.github.io/signin" class="btn btn-primary">Sign In</a>
                        <a href="https://aditya-cmd-max.github.io/signup" class="btn btn-outline">Sign Up</a>
                    </div>
                </div>
            `;
        }

        function showNotFound(message = 'Profile not found') {
            elements.contentArea.innerHTML = `
                <div class="not-found">
                    <i class="fas fa-user-slash not-found-icon"></i>
                    <h2 class="not-found-title">Profile Not Found</h2>
                    <p class="not-found-text">${message}</p>
                    <div class="flex gap-3 justify-center">
                        <a href="https://aditya-cmd-max.github.io/reverbit/" class="btn btn-primary">Go Home</a>
                        <a href="https://aditya-cmd-max.github.io/dashboard" class="btn btn-outline">Dashboard</a>
                    </div>
                </div>
            `;
        }

        function showToast(message, type = 'success') {
            elements.toast.className = `toast toast-${type}`;
            elements.toastMessage.textContent = message;
            elements.toast.classList.add('show');
            
            setTimeout(() => {
                elements.toast.classList.remove('show');
            }, 3000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function viewUserProfile(userId) {
            window.location.href = `?id=${userId}`;
            elements.searchResults.classList.remove('show');
            elements.searchInput.value = '';
        }

        async function updateLastActive() {
            if (!state.isOwner || !state.profileData) return;
            
            try {
                await db.collection('users').doc(state.profileData.uid).update({
                    lastActive: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                console.error('Error updating last active:', error);
            }
        }

        function getAvatarUrl(data) {
            if (data.photoURL) return data.photoURL;
            return `https://ui-avatars.com/api/?name=${encodeURIComponent(data.displayName || 'User')}&background=1a73e8&color=fff&bold=true&size=400`;
        }

        function calculateMemberDays(createdAt) {
            if (!createdAt) return 0;
            const diff = new Date() - new Date(createdAt);
            return Math.floor(diff / (1000 * 60 * 60 * 24));
        }

        function formatDate(date) {
            if (!date) return 'Unknown';
            return new Date(date).toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function formatLastActive(date) {
            if (!date) return 'Never';
            
            const now = new Date();
            const last = new Date(date);
            const diff = Math.floor((now - last) / 60000); // minutes
            
            if (diff < 1) return 'Just now';
            if (diff < 60) return `${diff}m ago`;
            if (diff < 1440) return `${Math.floor(diff / 60)}h ago`;
            if (diff < 10080) return `${Math.floor(diff / 1440)}d ago`;
            return formatDate(date);
        }

        async function logout() {
            try {
                await auth.signOut();
                window.location.href = 'https://aditya-cmd-max.github.io/signin';
            } catch (error) {
                console.error('Logout error:', error);
                showToast('Error logging out', 'error');
            }
        }

        // ==================== EXPOSE GLOBALLY ====================
        window.toggleTheme = toggleTheme;
        window.showAdminPanel = showAdminPanel;
        window.filterUsers = filterUsers;
        window.changePage = changePage;
        window.openVerifyModal = openVerifyModal;
        window.saveVerification = saveVerification;
        window.openDeleteModal = openDeleteModal;
        window.confirmDelete = confirmDelete;
        window.closeModal = closeModal;
        window.togglePrivacy = togglePrivacy;
        window.toggleFollow = toggleFollow;
        window.showFollowers = showFollowers;
        window.showFollowing = showFollowing;
        window.shareProfile = shareProfile;
        window.copyShareLink = copyShareLink;
        window.shareViaTwitter = shareViaTwitter;
        window.shareViaFacebook = shareViaFacebook;
        window.shareViaLinkedIn = shareViaLinkedIn;
        window.viewUserProfile = viewUserProfile;
        window.logout = logout;
        window.handleAvatarUpload = handleAvatarUpload;

        console.log(' Reverbit Profile with Follow System fully loaded');
    </script>

<script>

    // ==================== IMPROVED SEARCH FUNCTION ====================
async function searchUsers(query) {
    query = query.trim().toLowerCase();
    
    if (!query || query.length < 2) {
        elements.searchResults.classList.remove('show');
        return;
    }
    
    // Show loading state
    elements.searchResults.innerHTML = `
        <div class="text-center p-4">
            <div class="spinner spinner-sm"></div>
            <p class="mt-2">Searching...</p>
        </div>
    `;
    elements.searchResults.classList.add('show');
    
    try {
        // Get ALL users first (limited to 50 for performance)
        // In production, you'd want pagination or a search service
        const snapshot = await db.collection('users')
            .limit(50)
            .get();
        
        const allUsers = snapshot.docs.map(doc => ({
            uid: doc.id,
            ...doc.data()
        }));
        
        // Filter in memory (client-side)
        const results = allUsers
            .filter(user => {
                // Only show public profiles or the current user's own profile
                if (!user.isPublic && user.uid !== state.currentUser?.uid) {
                    return false;
                }
                
                // Search in name, email, username
                const searchableFields = [
                    user.displayName,
                    user.email,
                    user.username,
                    user.bio
                ].filter(Boolean).map(field => field.toLowerCase());
                
                return searchableFields.some(field => field.includes(query));
            })
            .slice(0, 10); // Limit to 10 results
        
        if (results.length === 0) {
            elements.searchResults.innerHTML = `
                <div class="no-results">
                    <i class="fas fa-search" style="font-size: 2rem; margin-bottom: var(--space-md); color: var(--text-tertiary);"></i>
                    <p>No users found matching "${query}"</p>
                </div>
            `;
            return;
        }
        
        // Display results
        elements.searchResults.innerHTML = results.map(user => `
            <div class="search-result-item" onclick="viewUserProfile('${user.uid}')">
                <img src="${getAvatarUrl(user)}" alt="${user.displayName || 'User'}" class="search-result-avatar"
                     onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || 'User')}&background=1a73e8&color=fff&bold=true'">
                <div class="search-result-info">
                    <div class="search-result-name">
                        ${user.displayName || 'User'}
                        ${getBadges(user)}
                        ${!user.isPublic ? '<span class="badge" style="background: var(--text-tertiary);"><i class="fas fa-lock"></i> Private</span>' : ''}
                    </div>
                    <div class="search-result-email">${user.email || ''}</div>
                    <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-top: 2px;">
                        <i class="fas fa-users"></i> ${user.followersCount || 0} followers
                    </div>
                </div>
            </div>
        `).join('');
        
    } catch (error) {
        console.error('Search error:', error);
        elements.searchResults.innerHTML = `
            <div class="no-results" style="color: var(--error-500);">
                <i class="fas fa-exclamation-circle" style="font-size: 2rem; margin-bottom: var(--space-md);"></i>
                <p>Error searching users</p>
                <p style="font-size: 0.85rem;">${error.message}</p>
            </div>
        `;
    }
}

// ==================== IMPROVED LOAD ALL USERS ====================
async function loadAllUsers() {
    try {
        // Only load public profiles for non-authenticated users
        let query = db.collection('users');
        
        if (!state.currentUser) {
            // If not logged in, only get public profiles
            query = query.where('isPublic', '==', true);
        }
        
        const snapshot = await query.limit(100).get(); // Limit for performance
        
        state.allUsers = snapshot.docs.map(doc => ({
            uid: doc.id,
            ...doc.data()
        }));
        
        // Sort by followers count
        state.allUsers.sort((a, b) => (b.followersCount || 0) - (a.followersCount || 0));
        
        console.log(` Loaded ${state.allUsers.length} users for search`);
        
    } catch (error) {
        console.error('Error loading users:', error);
        state.allUsers = [];
    }
}
</script>

    
</body>
</html>
